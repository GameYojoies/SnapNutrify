<div id="main" class="positionZero">
  <div id="body_main" class="bgSizeCover"></div>
  <div id="menu_main" style="width: 100%">
    <div
      id="menu_main_content"
      style="justify-content: space-between"
      class="bg-foot-all coverMenu"
    >
      <div id="menu_Logfood" class="menuCss menuDiv">
        <div class="menuCss_pic">
          <div class="menuOnClass" id="menuLogfood">
            <svg
              width="33"
              height="33"
              viewBox="0 0 26 26"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M23.1592 11.1866L21.3839 3.25796C21.2897 2.8374 21.0323 2.47147 20.6684 2.24068C20.3044 2.00988 19.8636 1.93312 19.4431 2.02729L3.58574 5.57792C3.16517 5.67209 2.79924 5.92947 2.56845 6.29344C2.33765 6.65741 2.26089 7.09816 2.35506 7.51872L5.90569 23.3761C5.99986 23.7966 6.25724 24.1626 6.62121 24.3934C6.98518 24.6242 7.42593 24.7009 7.84649 24.6067L15.7752 22.8314"
                fill="#5F8458"
              />
              <path
                d="M23.1592 11.1866L21.3839 3.25796C21.2897 2.8374 21.0323 2.47147 20.6684 2.24068C20.3044 2.00988 19.8636 1.93312 19.4431 2.02729L3.58574 5.57792C3.16517 5.67209 2.79924 5.92947 2.56845 6.29344C2.33765 6.65741 2.26089 7.09816 2.35506 7.51872L5.90569 23.3761C5.99986 23.7966 6.25724 24.1626 6.62121 24.3934C6.98518 24.6242 7.42593 24.7009 7.84649 24.6067L15.7752 22.8314"
                stroke="#C0D8A4"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M19.239 18.469C20.9906 18.0768 22.117 16.4482 21.755 14.8314C21.3929 13.2145 19.6796 12.2218 17.928 12.614C16.1764 13.0062 15.05 14.6348 15.412 16.2516C15.7741 17.8684 17.4874 18.8612 19.239 18.469Z"
                fill="#5F8458"
                stroke="#C0D8A4"
                stroke-width="2"
              />
              <path
                d="M21.6634 16.9015L24.7433 18.2614ZM7.32111 9.86523L17.8927 7.49815ZM8.19511 13.7686L12.4237 12.8217Z"
                fill="#5F8458"
              />
              <path
                d="M21.6634 16.9015L24.7433 18.2614M7.32111 9.86523L17.8927 7.49815M8.19511 13.7686L12.4237 12.8217"
                stroke="#C0D8A4"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>

          <div class="menuOffClass" id="menuLogfood2" style="display: none">
            <div
              style="
                width: 33px;
                height: 33px;
                justify-content: center;
                align-items: center;
                display: flex;
              "
            >
              <svg
                width="26"
                height="26"
                viewBox="0 0 26 26"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M22.75 13V4.875C22.75 4.44402 22.5788 4.0307 22.274 3.72595C21.9693 3.4212 21.556 3.25 21.125 3.25H4.875C4.44402 3.25 4.0307 3.4212 3.72595 3.72595C3.4212 4.0307 3.25 4.44402 3.25 4.875V21.125C3.25 21.556 3.4212 21.9693 3.72595 22.274C4.0307 22.5788 4.44402 22.75 4.875 22.75H13"
                  stroke="#5F8458"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M17.3333 20.5834C19.1282 20.5834 20.5833 19.1283 20.5833 17.3334C20.5833 15.5384 19.1282 14.0834 17.3333 14.0834C15.5384 14.0834 14.0833 15.5384 14.0833 17.3334C14.0833 19.1283 15.5384 20.5834 17.3333 20.5834Z"
                  stroke="#5F8458"
                  stroke-width="2"
                />
                <path
                  d="M20.0416 19.5L22.75 21.6666M7.58331 8.66663H18.4166M7.58331 13H11.9166"
                  stroke="#5F8458"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
          </div>
        </div>
        <span class="menuSpan" id="menuLogfoodSpan">History</span>
      </div>

      <div id="menu_home" class="menuCss menuDiv">
        <div class="menuCss_pic">
          <div class="menuOnClass" id="menuHome">
            <div
              style="
                border-radius: 50%;
                background-color: #5f8458;
                width: 52px;
                height: 52px;
                display: flex;
                justify-content: center;
                align-items: center;
              "
            >
              <svg
                width="33"
                height="33"
                viewBox="0 0 33 33"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3.80875 13.75C3.2175 13.75 2.75 13.2825 2.75 12.6912V9.515C2.75 5.78875 5.78875 2.75 9.515 2.75H12.6912C13.2825 2.75 13.75 3.2175 13.75 3.80875C13.75 4.4 13.2825 4.8675 12.6912 4.8675H9.515C6.94375 4.8675 4.8675 6.9575 4.8675 9.515V12.6912C4.8675 13.2825 4.38625 13.75 3.80875 13.75Z"
                  fill="#C0D8A4"
                />
                <path
                  d="M29.1912 13.75C28.6137 13.75 28.1325 13.2825 28.1325 12.6912V9.515C28.1325 6.94375 26.0425 4.8675 23.485 4.8675H20.3088C19.7175 4.8675 19.25 4.38625 19.25 3.80875C19.25 3.23125 19.7175 2.75 20.3088 2.75H23.485C27.2112 2.75 30.25 5.78875 30.25 9.515V12.6912C30.25 13.2825 29.7825 13.75 29.1912 13.75Z"
                  fill="#C0D8A4"
                />
                <path
                  d="M23.485 30.2501H21.5737C20.9962 30.2501 20.515 29.7826 20.515 29.1913C20.515 28.6138 20.9825 28.1326 21.5737 28.1326H23.485C26.0562 28.1326 28.1325 26.0426 28.1325 23.4851V21.5876C28.1325 21.0101 28.6 20.5288 29.1912 20.5288C29.7687 20.5288 30.25 20.9963 30.25 21.5876V23.4851C30.25 27.2113 27.2112 30.2501 23.485 30.2501Z"
                  fill="#C0D8A4"
                />
                <path
                  d="M12.6912 30.25H9.515C5.78875 30.25 2.75 27.2112 2.75 23.485V20.3088C2.75 19.7175 3.2175 19.25 3.80875 19.25C4.4 19.25 4.8675 19.7175 4.8675 20.3088V23.485C4.8675 26.0563 6.9575 28.1325 9.515 28.1325H12.6912C13.2687 28.1325 13.75 28.6 13.75 29.1912C13.75 29.7825 13.2825 30.25 12.6912 30.25Z"
                  fill="#C0D8A4"
                />
                <path
                  d="M25.3825 15.4412H23.5125H9.4875H7.6175C7.02625 15.4412 6.55875 15.9224 6.55875 16.4999C6.55875 17.0774 7.02625 17.5587 7.6175 17.5587H9.4875H23.5125H25.3825C25.9737 17.5587 26.4412 17.0774 26.4412 16.4999C26.4412 15.9224 25.9737 15.4412 25.3825 15.4412Z"
                  fill="#C0D8A4"
                />
                <path
                  d="M9.4875 19.1674V19.6212C9.4875 21.9037 11.33 23.7462 13.6125 23.7462H19.3875C21.67 23.7462 23.5125 21.9037 23.5125 19.6212V19.1674C23.5125 19.0024 23.3888 18.8787 23.2238 18.8787H9.77625C9.61125 18.8787 9.4875 19.0024 9.4875 19.1674Z"
                  fill="#C0D8A4"
                />
                <path
                  d="M9.4875 13.8324V13.3787C9.4875 11.0962 11.33 9.25366 13.6125 9.25366H19.3875C21.67 9.25366 23.5125 11.0962 23.5125 13.3787V13.8324C23.5125 13.9974 23.3888 14.1212 23.2238 14.1212H9.77625C9.61125 14.1212 9.4875 13.9974 9.4875 13.8324Z"
                  fill="#C0D8A4"
                />
              </svg>
            </div>
          </div>
          <div class="menuOffClass" id="menuHome2" style="display: none">
            <div
              style="
                border-radius: 50%;
                background-color: #5f8458;
                width: 52px;
                height: 52px;
                display: flex;
                justify-content: center;
                align-items: center;
              "
            >
              <svg
                width="25"
                height="24"
                viewBox="0 0 25 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3.27 10C2.84 10 2.5 9.66 2.5 9.23V6.92C2.5 4.21 4.71 2 7.42 2H9.73C10.16 2 10.5 2.34 10.5 2.77C10.5 3.2 10.16 3.54 9.73 3.54H7.42C5.55 3.54 4.04 5.06 4.04 6.92V9.23C4.04 9.66 3.69 10 3.27 10Z"
                  fill="white"
                />
                <path
                  d="M21.73 10C21.31 10 20.96 9.66 20.96 9.23V6.92C20.96 5.05 19.44 3.54 17.58 3.54H15.27C14.84 3.54 14.5 3.19 14.5 2.77C14.5 2.35 14.84 2 15.27 2H17.58C20.29 2 22.5 4.21 22.5 6.92V9.23C22.5 9.66 22.16 10 21.73 10Z"
                  fill="white"
                />
                <path
                  d="M17.58 21.9999H16.19C15.77 21.9999 15.42 21.6599 15.42 21.2299C15.42 20.8099 15.76 20.4599 16.19 20.4599H17.58C19.45 20.4599 20.96 18.9399 20.96 17.0799V15.6999C20.96 15.2799 21.3 14.9299 21.73 14.9299C22.15 14.9299 22.5 15.2699 22.5 15.6999V17.0799C22.5 19.7899 20.29 21.9999 17.58 21.9999Z"
                  fill="white"
                />
                <path
                  d="M9.73 22H7.42C4.71 22 2.5 19.79 2.5 17.08V14.77C2.5 14.34 2.84 14 3.27 14C3.7 14 4.04 14.34 4.04 14.77V17.08C4.04 18.95 5.56 20.46 7.42 20.46H9.73C10.15 20.46 10.5 20.8 10.5 21.23C10.5 21.66 10.16 22 9.73 22Z"
                  fill="white"
                />
                <path
                  d="M18.96 11.23H17.6H7.4H6.04C5.61 11.23 5.27 11.58 5.27 12C5.27 12.42 5.61 12.77 6.04 12.77H7.4H17.6H18.96C19.39 12.77 19.73 12.42 19.73 12C19.73 11.58 19.39 11.23 18.96 11.23Z"
                  fill="white"
                />
                <path
                  d="M7.39999 13.94V14.27C7.39999 15.93 8.73999 17.27 10.4 17.27H14.6C16.26 17.27 17.6 15.93 17.6 14.27V13.94C17.6 13.82 17.51 13.73 17.39 13.73H7.60999C7.48999 13.73 7.39999 13.82 7.39999 13.94Z"
                  fill="white"
                />
                <path
                  d="M7.39999 10.06V9.72998C7.39999 8.06998 8.73999 6.72998 10.4 6.72998H14.6C16.26 6.72998 17.6 8.06998 17.6 9.72998V10.06C17.6 10.18 17.51 10.27 17.39 10.27H7.60999C7.48999 10.27 7.39999 10.18 7.39999 10.06Z"
                  fill="white"
                />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div id="menu_setting" class="menuCss menuDiv">
        <div class="menuCss_pic">
          <div class="menuOnClass" id="menuSetting">
            <svg
              width="30"
              height="29"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M4.71447 15.4645C5.65215 14.5268 6.92392 14 8.25 14H16.25C17.5761 14 18.8479 14.5268 19.7855 15.4645C20.7232 16.4021 21.25 17.6739 21.25 19V21C21.25 21.5523 20.8023 22 20.25 22C19.6977 22 19.25 21.5523 19.25 21V19C19.25 18.2044 18.9339 17.4413 18.3713 16.8787C17.8087 16.3161 17.0456 16 16.25 16H8.25C7.45435 16 6.69129 16.3161 6.12868 16.8787C5.56607 17.4413 5.25 18.2044 5.25 19V21C5.25 21.5523 4.80228 22 4.25 22C3.69772 22 3.25 21.5523 3.25 21V19C3.25 17.6739 3.77678 16.4021 4.71447 15.4645Z"
                fill="#457BFF"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M12.25 4C10.5931 4 9.25 5.34315 9.25 7C9.25 8.65685 10.5931 10 12.25 10C13.9069 10 15.25 8.65685 15.25 7C15.25 5.34315 13.9069 4 12.25 4ZM7.25 7C7.25 4.23858 9.48858 2 12.25 2C15.0114 2 17.25 4.23858 17.25 7C17.25 9.76142 15.0114 12 12.25 12C9.48858 12 7.25 9.76142 7.25 7Z"
                fill="#457BFF"
              />
            </svg>
          </div>
          <div class="menuOffClass" id="menuSetting2" style="display: none">
            <svg
              width="28"
              height="27"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M4.71447 15.4645C5.65215 14.5268 6.92392 14 8.25 14H16.25C17.5761 14 18.8479 14.5268 19.7855 15.4645C20.7232 16.4021 21.25 17.6739 21.25 19V21C21.25 21.5523 20.8023 22 20.25 22C19.6977 22 19.25 21.5523 19.25 21V19C19.25 18.2044 18.9339 17.4413 18.3713 16.8787C17.8087 16.3161 17.0456 16 16.25 16H8.25C7.45435 16 6.69129 16.3161 6.12868 16.8787C5.56607 17.4413 5.25 18.2044 5.25 19V21C5.25 21.5523 4.80228 22 4.25 22C3.69772 22 3.25 21.5523 3.25 21V19C3.25 17.6739 3.77678 16.4021 4.71447 15.4645Z"
                fill="#97979B"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M12.25 4C10.5931 4 9.25 5.34315 9.25 7C9.25 8.65685 10.5931 10 12.25 10C13.9069 10 15.25 8.65685 15.25 7C15.25 5.34315 13.9069 4 12.25 4ZM7.25 7C7.25 4.23858 9.48858 2 12.25 2C15.0114 2 17.25 4.23858 17.25 7C17.25 9.76142 15.0114 12 12.25 12C9.48858 12 7.25 9.76142 7.25 7Z"
                fill="#97979B"
              />
            </svg>
          </div>
        </div>
        <span class="menuSpan" id="menuSettingSpan">Setting</span>
      </div>
    </div>
  </div>
</div>

<script>
  console.log("main");

  var mainObj = new main();
  mainObj.init();
  mainObj.menuhome();

  function main() {
    this.init = function () {
      setAllUILang("main");

      $("#menu_main").css({ height: menuH });
      $("#body_main").css({ height: h - menuH });

      $("#menu_home").click(function () {
        mainObj.menuhome();
      });

      $("#menu_Logfood").click(function () {
        mainObj.menuLogfood();
      });

      $("#menu_setting").click(function () {
        mainObj.menusetting();
      });

      mResObj.showHtml("home.html", "body_main");
      mResObj.showHtml("logfood.html", "body_main");
      mResObj.showHtml("setting.html", "body_main");
    };

    this.menuhome = function () {
      unShowMenuPage();

      $(".menuOnClass").css({ display: "none" });
      $(".menuOffClass").css({ display: "block" });
      $("#menuHome").css({ display: "block" });
      $("#menuHome2").css({ display: "none" });

      $("#menuLogfoodSpan,#menuSettingSpan").css({
        color: "#5F8458",
        "font-size": "12px",
      });

      $("#main").css({
        background: "rgb(227,214,194)", // Fallback color
        background:
          "linear-gradient(180deg, rgba(227,214,194,1) 0%, rgba(255,254,253,1) 100%)",
      });

      homeObj.init();
      homeObj.call();
    };

    this.menuLogfood = function () {
      unShowMenuPage();

      $(".menuOnClass").css({ display: "none" });
      $(".menuOffClass").css({ display: "block" });
      $("#menuLogfood").css({ display: "block" });
      $("#menuLogfood2").css({ display: "none" });
      $("#menuLogfoodSpan").css({
        color: "#5F8458",
        "font-size": "12px",
        "font-weight": "bold",
      });
      $("#menuHomeSpan, #menuSettingSpan").css({
        color: "#5F8458",
        "font-size": "10px",
      });
      $("#main").css({
        background:
          "#fff",
      });

      logfoodObj.init();
      logfoodObj.call();
    };

    this.menusetting = function () {
      unShowMenuPage();

      $(".menuOnClass").css({ display: "none" });
      $(".menuOffClass").css({ display: "block" });
      $("#menuSetting").css({ display: "block" });
      $("#menuSetting2").css({ display: "none" });
      $("#menuSettingSpan").css({ color: "#5F8458", "font-size": "12px" });
      $("#menuHomeSpan, #menuLogfoodSpan").css({
        color: "#5F8458",
        "font-size": "12px",
      });
      $("#main").css({ "background-color": "#5F8458" });

      settingObj.init();
      settingObj.call();
    };

    this.checkIsLogin = function () {
      getLocalToken();
      updateLoginStatus();
      if (token != null) {
        mainObj.refreshToken();
      } else {
        pageShow("loginPage");
      }
    };

    function unShowMenuPage() {
      $(".menuPage").each(function () {
        $("#" + this.id).transition(
          {
            x: 0,
          },
          0
        );
      });
      $(".menuHeader").each(function () {
        $("#" + this.id).transition(
          {
            x: 0,
          },
          0
        );
      });
    }

    function updateLoginStatus() {
      var isLogin = true;
      // if (token != null) {
      //     var nowTimeStamp = (new Date()).getTime();
      //     if (token.expire) {
      //         var expireTime = token.expire * 1000;
      //         if (nowTimeStamp < expireTime) {
      //             isLogin = true;
      //         } else {
      //             mainObj.refreshToken();
      //         }
      //     }
      // }

      if (isLogin) {
        startObj.init();
        pageShow("startPage");

        $("#start_app").click(function () {
          $("#startPage").transition(
            {
              x: 0,
            },
            0
          );
          mainObj.menuhome();
        });

        //
      } else {
        pageShow("loginPage");
      }
    }
    updateLoginStatus();
    function getLocalToken() {
      var tokenLocal = localStorage.getItem("token");
      if (tokenLocal != null) {
        token = JSON.parse(tokenLocal);
      }
    }

    var isRefreshTokenFinish = true;

    //30分钟刷新一次 รีเฟรชทุกๆ 30 นาที
    this.refreshToken = function () {
      if (refreshTokenTimer) {
        clearInterval(refreshTokenTimer);
      }
      refreshTokenTimer = setInterval(function () {
        refreshTokenFun();
      }, 1800000);
    };

    function refreshTokenFun() {
      if (token == null) {
        pageShow("loginPage");
        return;
      }

      var mData = { token: token.refresh };
      isRefreshTokenFinish = false;

      $.ajax({
        type: "post",
        url: API_SERVER + "/v1/auth/refresh",
        data: JSON.stringify(mData),
        contentType: "application/json",
        dataType: "json",
        async: true,
        timeout: 100000,
        beforeSend: function (xmlhttprequest) {},
        success: function (data) {
          if (data.code == 0) {
            var tokenObj = data.result;
            localStorage.setItem("token", JSON.stringify(tokenObj));
            getLocalToken();
            isRefreshTokenFinish = true;
          } else {
            mainObj.checkAjaxResult(data.code);
          }
        },
        error: function (xmlhttprequest, error) {
          console.log(error);
        },
        complete: function () {},
      });
    }

    this.checkAjaxResult = function (code, fun4001) {
      switch (code) {
        case 4001:
          refreshTokenFun();
          if (fun4001) {
            fun4001();
          } else {
            logoutFun();
          }
          break;
        case 4002:
          logoutFun();
          break;
        case 4020:
          if (isRefreshTokenFinish) {
            Swal.fire({
              icon: "warning",
              showConfirmButton: false,
              title: `<span style='color:#1E232C;font-size: var(--text-size03);'><b id='main_device'></b></span>`,
              html:
                '<div style="display: flex;justify-content: space-between;align-items: center;">' +
                "</div>",
            });

            logoutFun();
          } else {
            refreshTokenFun();
          }
          break;
      }

      function logoutFun() {
        localStorage.removeItem("token");
        token = null;
        mainObj.checkIsLogin();
        if (heartBeatTimer) {
          clearInterval(heartBeatTimer);
        }
        if (refreshTokenTimer) {
          clearInterval(refreshTokenTimer);
        }
      }
    };
  }
</script>
